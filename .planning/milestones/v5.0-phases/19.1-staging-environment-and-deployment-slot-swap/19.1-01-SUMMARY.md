---
phase: 19.1-staging-environment-and-deployment-slot-swap
plan: 01
subsystem: infra
tags: [github-actions, azure-swa, preview-environments, ci-cd]

# Dependency graph
requires:
  - phase: 19-welcome-popup-and-local-mode-onboarding
    provides: "Deployed frontend with onboarding flow"
provides:
  - "PR builds create frontend-only SWA preview environments without deploying API"
  - "Push-to-main continues to deploy both API and frontend to production"
  - "Documentation of preview environment workflow and limitations"
affects: [deployment, ci-cd]

# Tech tracking
tech-stack:
  added: []
  patterns: ["Conditional step execution via github.event_name in GitHub Actions"]

key-files:
  created: []
  modified:
    - ".github/workflows/azure-static-web-apps-lemon-hill-0d4d7521e.yml"
    - "deployment.md"

key-decisions:
  - "Gate both API build and deploy steps (not just deploy) to save CI time on PRs"

patterns-established:
  - "Use if: github.event_name == 'push' to gate production-only deployment steps"

requirements-completed: []

# Metrics
duration: 1min
completed: 2026-02-23
---

# Phase 19.1 Plan 01: Gate API Deployment and Document Preview Environments Summary

**Conditional API deployment gated to push-to-main only, with SWA preview environment documentation for PR workflows**

## Performance

- **Duration:** 1 min
- **Started:** 2026-02-23T01:54:32Z
- **Completed:** 2026-02-23T01:55:56Z
- **Tasks:** 2
- **Files modified:** 2

## Accomplishments
- Gated API build and deploy steps in GitHub Actions to run only on push-to-main events
- PR builds now create frontend-only SWA preview environments without touching production API
- Added comprehensive "Preview environments" section to deployment.md documenting URL format, behavior, and Free tier limits

## Task Commits

Each task was committed atomically:

1. **Task 1: Gate API deployment to main-only** - `70d0c82` (feat)
2. **Task 2: Update deployment.md with preview environment docs** - `8894092` (docs)

## Files Created/Modified
- `.github/workflows/azure-static-web-apps-lemon-hill-0d4d7521e.yml` - Added `if: github.event_name == 'push'` conditions to API build and deploy steps
- `deployment.md` - Updated PR deploy description and added Preview environments section

## Decisions Made
- Gated both the "Install and build API" step AND the "Deploy API to Functions app" step (not just the deploy) to avoid wasting CI time building an API that won't be deployed on PR builds

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
None.

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Preview environments are ready for use on the next PR opened against main
- Phase 20 (Auto Sign-In for Returning Users) can proceed independently

## Self-Check: PASSED

- FOUND: 19.1-01-SUMMARY.md
- FOUND: 70d0c82 (Task 1 commit)
- FOUND: 8894092 (Task 2 commit)

---
*Phase: 19.1-staging-environment-and-deployment-slot-swap*
*Completed: 2026-02-23*
