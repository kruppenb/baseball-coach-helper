---
phase: 02-lineup-engine
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/lineup/PreAssignments.tsx
  - src/components/lineup/PreAssignments.module.css
  - src/components/lineup/PositionBlocks.tsx
  - src/components/lineup/PositionBlocks.module.css
  - src/styles/tokens.css
autonomous: true

must_haves:
  truths:
    - "Coach can select a pitcher for each inning from a dropdown of present players"
    - "Coach can select a catcher for each inning from a dropdown of present players"
    - "Coach can leave pitcher/catcher unassigned for any inning (-- option)"
    - "Coach can toggle position blocks for each player (tap chip to block/unblock)"
    - "Blocked positions are visually distinct (crossed out / red)"
  artifacts:
    - path: "src/components/lineup/PreAssignments.tsx"
      provides: "Pitcher and catcher per-inning assignment UI with native selects"
      exports: ["PreAssignments"]
      min_lines: 40
    - path: "src/components/lineup/PreAssignments.module.css"
      provides: "Grid layout for inning rows with P/C selects"
      min_lines: 15
    - path: "src/components/lineup/PositionBlocks.tsx"
      provides: "Per-player position block toggles using tappable chips"
      exports: ["PositionBlocks"]
      min_lines: 40
    - path: "src/components/lineup/PositionBlocks.module.css"
      provides: "Chip styling with blocked/unblocked states"
      min_lines: 15
  key_links:
    - from: "src/components/lineup/PreAssignments.tsx"
      to: "src/types/index.ts"
      via: "imports Player, BatteryAssignments"
      pattern: "import.*from.*types"
    - from: "src/components/lineup/PositionBlocks.tsx"
      to: "src/types/index.ts"
      via: "imports Player, Position, POSITIONS, PositionBlocks type"
      pattern: "import.*from.*types"
---

<objective>
Build the pre-assignment and position blocking UI components that coaches use before generating lineups.

Purpose: Coaches need to assign pitchers/catchers and block positions before hitting "Generate." These components collect the input that feeds into the generation algorithm. Building them as standalone presentational components (props in, callbacks out) means they can be developed in parallel with the generator algorithm.

Output: PreAssignments.tsx (P/C dropdowns per inning) and PositionBlocks.tsx (toggleable position chips per player), both with CSS Module styling following Phase 1 conventions.
</objective>

<execution_context>
@C:/Users/nicho/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/nicho/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-lineup-engine/02-RESEARCH.md

# Phase 1 patterns to follow
@src/types/index.ts
@src/styles/tokens.css
@src/components/game-setup/GameSetupPage.tsx
@src/components/game-setup/SettingsPanel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build PreAssignments component with per-inning P/C selectors</name>
  <files>src/components/lineup/PreAssignments.tsx, src/components/lineup/PreAssignments.module.css</files>
  <action>
    Create PreAssignments.tsx as a presentational component receiving props (no hook consumption -- the parent will wire hooks later in Plan 02-04).

    **Props interface:**
    ```
    interface PreAssignmentsProps {
      innings: number;
      presentPlayers: Player[];
      pitcherAssignments: BatteryAssignments;
      catcherAssignments: BatteryAssignments;
      onPitcherChange: (inning: number, playerId: string) => void;
      onCatcherChange: (inning: number, playerId: string) => void;
    }
    ```

    **Component structure:**
    - Section heading: "Pitchers and Catchers" (h3)
    - Hint text below heading: "Assign who pitches and catches each inning. Leave blank to let the generator decide."
    - For each inning (1 to innings), render a row containing:
      - Inning label: "Inning {N}" (span)
      - Pitcher select: native `<select>` with label "P:" and options = [blank "--" option] + presentPlayers.map(p => option with value=p.id and text=p.name)
      - Catcher select: same pattern with label "C:"
    - Select values bind to pitcherAssignments[inning] and catcherAssignments[inning], defaulting to '' if unset
    - onChange calls onPitcherChange/onCatcherChange with (inning, e.target.value)
    - When value is '' (blank option), pass empty string to callback (parent decides how to handle clearing)

    **CSS Module (PreAssignments.module.css):**
    - Use CSS custom properties from tokens.css
    - .preAssignments: padding using --space-lg
    - .sectionTitle: font-size --font-size-lg, font-weight 600, margin-bottom --space-sm
    - .hint: font-size --font-size-sm, color --color-text-muted, margin-bottom --space-lg
    - .grid: display flex, flex-direction column, gap --space-md
    - .inningRow: display flex, align-items center, gap --space-md. Flex-wrap for narrow screens.
    - .inningLabel: min-width 70px, font-weight 600, font-size --font-size-base
    - .selectLabel: display flex, align-items center, gap --space-xs, font-size --font-size-sm, font-weight 500
    - .playerSelect: min-height --min-tap-size, padding --space-xs --space-sm, border 1px solid --color-border, border-radius --radius-sm, font-size --font-size-base, font-family --font-family, background white. Min-width 120px for readability.

    **Do NOT:**
    - Import or call any hooks -- this is a pure presentational component
    - Add real-time validation here (validation panel handles that in Plan 02-04)
    - Use custom dropdown components -- use native `<select>` per research recommendation
  </action>
  <verify>
    - `npm run build` passes with zero TypeScript errors
    - PreAssignments.tsx exports the component
    - Component accepts all props from interface
    - File has no React hook calls (no useState, useEffect, etc.)
    - CSS Module file exists with all documented classes
  </verify>
  <done>PreAssignments component renders inning rows with P/C selects, binds to prop values, fires callbacks on change. Fully presentational with no internal state.</done>
</task>

<task type="auto">
  <name>Task 2: Build PositionBlocks component with toggleable position chips</name>
  <files>src/components/lineup/PositionBlocks.tsx, src/components/lineup/PositionBlocks.module.css, src/styles/tokens.css</files>
  <action>
    Create PositionBlocks.tsx as a presentational component. Also extend tokens.css with a few lineup-specific tokens.

    **Extend src/styles/tokens.css:** Add these tokens (append to existing :root block):
    ```css
    /* Lineup-specific */
    --color-blocked: #dc3545;
    --color-blocked-bg: #f8d7da;
    --color-success: #198754;
    --color-success-bg: #d1e7dd;
    ```
    Note: --color-blocked reuses the existing --color-danger value. Adding it as a semantic alias for clarity.

    **Props interface:**
    ```
    interface PositionBlocksProps {
      presentPlayers: Player[];
      positionBlocks: PositionBlocks;  // from types: Record<string, Position[]>
      onToggleBlock: (playerId: string, position: Position) => void;
    }
    ```

    **Component structure:**
    - Section heading: "Position Blocks" (h3)
    - Hint text: "Tap a position to block a player from playing there. Blocked positions show in red."
    - Collapsible section (use a `<details>` / `<summary>` element for simplicity -- no JS state needed for collapse):
      - Summary text: "Set position blocks ({N} active)" where N = total number of blocked positions across all players
      - Content: For each presentPlayer, render a row:
        - Player name (span, font-weight 500)
        - Row of 9 position chips (one per POSITIONS constant): small buttons displaying position abbreviation
        - Each chip is a `<button>` with:
          - type="button"
          - aria-pressed={isBlocked} for accessibility
          - className toggled between .chip and .chip + .chipBlocked based on whether positionBlocks[playerId]?.includes(position)
          - onClick -> onToggleBlock(playerId, position)
    - If no present players, show message: "Mark players as present on the Game Setup tab first."

    **CSS Module (PositionBlocks.module.css):**
    - .positionBlocks: padding using --space-lg
    - .sectionTitle: same as PreAssignments
    - .hint: same as PreAssignments
    - .details: border 1px solid --color-border, border-radius --radius-md, margin-top --space-md
    - .summary: padding --space-md, cursor pointer, font-weight 500, user-select none. On hover: background --color-surface-hover
    - .playerRow: display flex, align-items center, gap --space-sm, padding --space-sm --space-md, border-bottom 1px solid --color-border. Last child: no border.
    - .playerName: min-width 100px, font-weight 500, font-size --font-size-sm
    - .chips: display flex, gap --space-xs, flex-wrap wrap
    - .chip: min-width 36px, min-height 32px, padding --space-xs --space-sm, border 1px solid --color-border, border-radius --radius-sm, background --color-surface, font-size --font-size-sm, font-family --font-family, cursor pointer, transition background-color 0.15s, border-color 0.15s. On hover: background --color-surface-hover.
    - .chipBlocked: background --color-blocked-bg, border-color --color-blocked, color --color-blocked, text-decoration line-through. On hover: filter brightness(0.95).

    **Do NOT:**
    - Use useState for collapse state -- `<details>` handles this natively
    - Import hooks
    - Add P/C assignment warnings here (that belongs in validation)
  </action>
  <verify>
    - `npm run build` passes with zero TypeScript errors
    - PositionBlocks.tsx exports the component
    - tokens.css has the new lineup-specific tokens
    - Chip buttons have aria-pressed attribute
    - Blocked state has visual distinction (line-through + red background)
    - File has no React hook calls
  </verify>
  <done>PositionBlocks component renders collapsible player list with toggleable position chips. Blocked positions show crossed out in red. Active block count displayed in summary. Fully presentational.</done>
</task>

</tasks>

<verification>
- `npm run build` passes with zero TypeScript errors
- Both components export correctly and accept their documented props interfaces
- Both components are purely presentational (no hooks, no internal data fetching)
- CSS follows Phase 1 conventions (CSS Modules, custom properties from tokens.css)
- Native `<select>` used for P/C dropdowns (not custom components)
- `<details>`/`<summary>` used for collapsible position blocks (no JS state)
- Accessibility: selects have associated labels, chips have aria-pressed
</verification>

<success_criteria>
- PreAssignments renders a P and C dropdown per inning using native selects
- Dropdowns bind to prop values and fire callbacks
- PositionBlocks renders toggleable position chips per present player
- Blocked positions are visually red with line-through
- Both components are ready to be wired into LineupPage in Plan 02-04
- No new npm dependencies added
</success_criteria>

<output>
After completion, create `.planning/phases/02-lineup-engine/02-03-SUMMARY.md`
</output>
