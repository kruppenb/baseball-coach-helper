---
phase: 10-app-restructuring-and-game-day-flow
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/index.ts
  - src/hooks/useStepperState.ts
  - src/components/app-shell/TabBar.tsx
  - src/components/app-shell/TabBar.module.css
  - src/components/app-shell/AppShell.tsx
  - src/components/app-shell/AppShell.module.css
  - src/components/settings/SettingsPage.tsx
  - src/components/settings/SettingsPage.module.css
autonomous: true

must_haves:
  truths:
    - "App opens to Game Day tab by default (not Roster)"
    - "Bottom tab bar shows Game Day and Settings tabs, always visible"
    - "Settings page contains roster management with add/rename/delete"
    - "Settings page contains CSV import and export buttons"
    - "Settings page contains position blocks configuration"
    - "Settings page contains innings configuration dropdown"
    - "Settings page contains sync status indicator"
  artifacts:
    - path: "src/types/index.ts"
      provides: "StepId and StepperState types"
      contains: "StepId"
    - path: "src/hooks/useStepperState.ts"
      provides: "Stepper state machine hook"
      exports: ["useStepperState"]
    - path: "src/components/app-shell/AppShell.tsx"
      provides: "2-tab app shell with Game Day and Settings"
      contains: "game-day"
    - path: "src/components/settings/SettingsPage.tsx"
      provides: "Consolidated settings page"
      contains: "SettingsPage"
  key_links:
    - from: "src/components/app-shell/AppShell.tsx"
      to: "src/components/settings/SettingsPage.tsx"
      via: "conditional render on activeTab"
      pattern: "activeTab.*settings"
    - from: "src/hooks/useStepperState.ts"
      to: "src/types/index.ts"
      via: "StepId type import"
      pattern: "import.*StepId"
---

<objective>
Restructure the app shell from 4-tab top navigation to 2-tab bottom navigation (Game Day + Settings), create the stepper state hook, and build the consolidated Settings page.

Purpose: Establishes the new navigation structure that all subsequent plans build upon. The coach lands on Game Day by default, and all configuration is consolidated into Settings.
Output: Working 2-tab app with bottom nav, stepper hook ready for use, and fully functional Settings page.
</objective>

<execution_context>
@C:/Users/nicho/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/nicho/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-app-restructuring-and-game-day-flow/10-CONTEXT.md
@.planning/phases/10-app-restructuring-and-game-day-flow/10-RESEARCH.md
@src/types/index.ts
@src/components/app-shell/AppShell.tsx
@src/components/app-shell/AppShell.module.css
@src/components/app-shell/TabBar.tsx
@src/components/app-shell/TabBar.module.css
@src/components/roster/RosterPage.tsx
@src/components/game-setup/GameSetupPage.tsx
@src/components/game-setup/SettingsPanel.tsx
@src/components/lineup/PositionBlocks.tsx
@src/components/app-shell/SyncStatusIndicator.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add stepper types, create useStepperState hook, and restructure app shell to 2-tab bottom nav</name>
  <files>
    src/types/index.ts
    src/hooks/useStepperState.ts
    src/components/app-shell/TabBar.tsx
    src/components/app-shell/TabBar.module.css
    src/components/app-shell/AppShell.tsx
    src/components/app-shell/AppShell.module.css
  </files>
  <action>
**1. Add stepper types to `src/types/index.ts`:**

Add after the existing types (do NOT remove anything):

```typescript
// --- Stepper Types ---
export type StepId = 'attendance' | 'pc-assignment' | 'generate' | 'review' | 'print';

export interface StepperState {
  currentStep: StepId;
  completedSteps: Set<StepId>;
  hasCompletedAllOnce: boolean;
  staleWarning: boolean;
}
```

Also update the TabId type:
```typescript
export type TabId = 'game-day' | 'settings';
```

**2. Create `src/hooks/useStepperState.ts`:**

Stepper state machine hook with these behaviors:
- 5 ordered steps: `['attendance', 'pc-assignment', 'generate', 'review', 'print']`
- `currentStep` starts at `'attendance'`
- `completedSteps` is a `Set<StepId>` (initially empty)
- `hasCompletedAllOnce` is `false` initially, becomes `true` when all 5 steps have been completed at least once
- `staleWarning` is `false` initially
- Expose actions:
  - `goToStep(step: StepId)`: If `hasCompletedAllOnce`, jump freely. Otherwise, only allow jumping to completed steps or the next incomplete step. If jumping backward past 'generate' when a lineup has been generated, set `staleWarning = true`.
  - `completeStep(step: StepId)`: Marks step as completed. If all 5 are completed, set `hasCompletedAllOnce = true`. Auto-advances to next step if not already at the last step.
  - `clearStaleWarning()`: Sets `staleWarning = false`
  - `resetStepper()`: Resets to initial state (new game session)
- `canAdvance(step: StepId)` computed: returns `true` if step is completed
- `canNavigate(step: StepId)` computed: returns `true` if `hasCompletedAllOnce` OR step is completed OR step is the next incomplete step
- All state in `useState`/`useReducer` (NOT persisted -- stepper is transient per session)

**3. Modify `src/components/app-shell/TabBar.tsx`:**

Keep the existing ARIA pattern (role=tablist, role=tab, aria-selected, keyboard navigation). Change nothing functionally except update the CSS class reference for bottom positioning. The tab data will come from the parent (AppShell) which now passes only 2 tabs.

**4. Modify `src/components/app-shell/TabBar.module.css`:**

Move tab bar to bottom:
- Remove `border-bottom` from `.tabBar`, add `border-top: 2px solid var(--color-border)`
- Add `position: fixed; bottom: 0; left: 0; right: 0; z-index: 100; background: var(--color-bg, #fff);`
- Center the tabs: `justify-content: center; gap: var(--space-xl);`
- Keep existing `.tab`, `.tab.active`, `.tab:disabled`, `.tab:focus-visible` styles

**5. Modify `src/components/app-shell/AppShell.tsx`:**

Replace 4-tab structure with 2 tabs:
- `useState<TabId>('game-day')` -- default to Game Day
- `tabs` array: `[{ id: 'game-day', label: 'Game Day' }, { id: 'settings', label: 'Settings' }]`
- Remove `useRoster()` import and `presentCount` logic (no longer needed for tab disabling)
- Remove `useEffect` that redirected to game-setup when lineup < 9
- Conditional render: `activeTab === 'game-day'` renders a placeholder `<div>Game Day Stepper (coming in Plan 02)</div>`, `activeTab === 'settings'` renders `<SettingsPage />`
- Import SettingsPage from `'../settings/SettingsPage'`
- Remove old imports: RosterPage, GameSetupPage, LineupPage, HistoryPage, useRoster
- TabBar rendered AFTER `<main>` content (bottom position in DOM)

**6. Modify `src/components/app-shell/AppShell.module.css`:**

Add `padding-bottom: 60px;` to `.content` to account for fixed bottom tab bar. Keep `.shell` as-is.
  </action>
  <verify>
Run `npx tsc --noEmit` from repo root -- no type errors. Open browser at localhost:5180, confirm:
1. Bottom tab bar with "Game Day" and "Settings" tabs
2. Game Day is selected by default
3. Switching to Settings tab works
  </verify>
  <done>App shell shows 2 bottom tabs (Game Day default, Settings). Stepper hook exists with correct state machine. Types defined.</done>
</task>

<task type="auto">
  <name>Task 2: Build consolidated Settings page with all configuration sections</name>
  <files>
    src/components/settings/SettingsPage.tsx
    src/components/settings/SettingsPage.module.css
  </files>
  <action>
**1. Create `src/components/settings/SettingsPage.tsx`:**

A single scrollable page with clear section headers (h2 for page title, h3 for sections). Section order per locked decision: Roster -> CSV Import/Export -> Position Blocks -> Innings Config -> Sync Status.

```tsx
import { useState, useRef } from 'react';
import { useRoster } from '../../hooks/useRoster';
import { useGameConfig } from '../../hooks/useGameConfig';
import { useLineup } from '../../hooks/useLineup';
import { exportRosterCsv, downloadCsv, parseRosterCsv } from '../../logic/csv';
import { PlayerInput } from '../roster/PlayerInput';
import { PlayerList } from '../roster/PlayerList';
import { PositionBlocks } from '../lineup/PositionBlocks';
import { SettingsPanel } from '../game-setup/SettingsPanel';
import { SyncStatusIndicator } from '../app-shell/SyncStatusIndicator';
import styles from './SettingsPage.module.css';
```

Sections:

**Roster section (SETT-01):**
- `<h3>Roster</h3>`
- Render `<PlayerInput onAdd={addPlayer} />` and `<PlayerList players={players} onRename={renamePlayer} onDelete={removePlayer} />`
- Uses `useRoster()` hook

**CSV Import/Export section (SETT-02):**
- `<h3>CSV Import / Export</h3>`
- Export button calls `downloadCsv(exportRosterCsv(players), 'roster.csv')`
- Import button triggers hidden file input, parses CSV, calls `importPlayers(names)`
- Show import status message (auto-clear after 5s) -- replicate logic from current RosterPage
- Uses same `useRoster()` data from above (single hook call at top of component)

**Position Blocks section (SETT-03):**
- `<h3>Position Blocks</h3>`
- Render `<PositionBlocks presentPlayers={presentPlayers} positionBlocks={positionBlocks} onToggleBlock={togglePositionBlock} />`
- Uses `useLineup()` for presentPlayers, positionBlocks, togglePositionBlock

**Innings Config section (SETT-04):**
- `<h3>Innings</h3>`
- Render `<SettingsPanel innings={config.innings} onInningsChange={setInnings} />`
- Uses `useGameConfig()` for config and setInnings

**Sync Status section (SETT-05):**
- `<h3>Sync Status</h3>`
- Render `<SyncStatusIndicator />` (the full-size version)
- Also import and use `useAuth()` to show auth state: if user is signed in, show their display name. If not, show a message that sync is available when signed in.

Each section separated by a clear horizontal rule or spacing. No tabs, no accordions -- just a flat scrollable list per locked decision.

**2. Create `src/components/settings/SettingsPage.module.css`:**

```css
.page {
  padding: var(--space-md);
}

.sectionTitle {
  font-size: var(--font-size-xl);
  margin-top: var(--space-xl);
  margin-bottom: var(--space-md);
  padding-bottom: var(--space-sm);
  border-bottom: 1px solid var(--color-border);
}

.sectionTitle:first-of-type {
  margin-top: 0;
}

.csvActions {
  display: flex;
  gap: var(--space-md);
  margin-bottom: var(--space-md);
}

.csvButton {
  min-height: var(--min-tap-size);
  padding: var(--space-sm) var(--space-lg);
  font-size: var(--font-size-base);
  background: var(--color-bg);
  border: 2px solid var(--color-border);
  border-radius: var(--radius-md);
  cursor: pointer;
}

.importStatus {
  color: var(--color-success);
  font-size: var(--font-size-sm);
  margin-bottom: var(--space-md);
}

.syncSection {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
}

.syncInfo {
  font-size: var(--font-size-base);
  color: var(--color-text-muted);
}
```

Reuse existing design token variables. Keep styles consistent with existing pages (touch-friendly tap targets, readable fonts).
  </action>
  <verify>
Run `npx tsc --noEmit` -- no type errors. Navigate to Settings tab. Confirm all 5 sections render:
1. Roster: can add/rename/delete players
2. CSV: export and import buttons work
3. Position Blocks: shows present players with position toggles
4. Innings: dropdown to select 5 or 6 innings
5. Sync Status: shows sync state
  </verify>
  <done>Settings page consolidates all configuration. All 5 sections functional. Existing components reused without modification. Scrollable single page with clear section headers.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. App loads at localhost:5180 with Game Day tab selected by default
3. Bottom tab bar visible at all times with 2 tabs
4. Settings tab shows all 5 sections in correct order (Roster, CSV, Position Blocks, Innings, Sync)
5. All existing functionality preserved on Settings page (add player, rename, delete, CSV import/export, position blocks, innings change)
6. useStepperState hook file exists and exports correctly
</verification>

<success_criteria>
- App opens to Game Day tab by default
- 2-tab bottom navigation (Game Day, Settings) always visible
- Settings page has all 5 sections functional
- No TypeScript errors
- Stepper hook ready for Plan 02
</success_criteria>

<output>
After completion, create `.planning/phases/10-app-restructuring-and-game-day-flow/10-01-SUMMARY.md`
</output>
