---
phase: 18-v4-polish-and-closeout
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/app-shell/AppShell.tsx
  - .planning/REQUIREMENTS.md
autonomous: true
requirements: [GFLW-01, GFLW-03]
gap_closure: true

must_haves:
  truths:
    - "Re-printing with the same game label in the same session opens the browser print dialog"
    - "Clicking New Game from the History or Settings tab navigates the user to the Game Day tab"
    - "All 10 v4.0 requirement checkboxes in REQUIREMENTS.md are checked"
  artifacts:
    - path: "src/components/app-shell/AppShell.tsx"
      provides: "Fixed re-print trigger and New Game tab navigation"
      contains: "setActiveTab"
    - path: ".planning/REQUIREMENTS.md"
      provides: "All v4.0 requirements marked complete"
      contains: "[x]"
  key_links:
    - from: "handleGameLabelConfirm"
      to: "useEffect print trigger"
      via: "print sequence counter forces effect to fire even when label is unchanged"
      pattern: "printSeq|printSequence"
    - from: "handleDontSave / handleSaveAndNew"
      to: "setActiveTab"
      via: "navigating to game-day tab after New Game reset"
      pattern: "setActiveTab.*game-day"
---

<objective>
Fix two low-severity integration edge cases in the game-day flow and mark all v4.0 requirements as satisfied.

Purpose: Close the final two integration gaps (INT-01 re-print trigger, INT-02 New Game tab navigation) to complete the v4.0 milestone.
Output: Patched AppShell.tsx with both fixes, updated REQUIREMENTS.md with all checkboxes checked.
</objective>

<execution_context>
@C:/Users/nicho/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/nicho/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-game-flow-gap-closure/17-01-SUMMARY.md
@src/components/app-shell/AppShell.tsx
@.planning/REQUIREMENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix INT-01 re-print trigger and INT-02 New Game tab navigation in AppShell</name>
  <files>src/components/app-shell/AppShell.tsx</files>
  <action>
Fix two bugs in AppShell.tsx:

**INT-01 — Re-print with same label fails:**
The print `useEffect` (line ~123) watches `currentGameLabel` to trigger `window.print()`. When the user re-prints with the same label text, `setCurrentGameLabel(label)` is a no-op because React skips state updates when the value is identical. The effect never fires.

Fix: Add a `printSeq` state counter (initialized to 0). In `handleGameLabelConfirm`, increment `printSeq` alongside setting the label. Change the `useEffect` dependency array to include `printSeq` instead of (or in addition to) `currentGameLabel`. The effect guard becomes `if (pendingPrint.current && currentGameLabel)` — unchanged — but now the effect fires because `printSeq` changed.

Specifically:
1. Add `const [printSeq, setPrintSeq] = useState(0);` near existing dialog state
2. In `handleGameLabelConfirm`, after `setCurrentGameLabel(label)`, add `setPrintSeq(s => s + 1);`
3. Change the `useEffect` dependency array from `[currentGameLabel]` to `[currentGameLabel, printSeq]`
4. No other changes needed — the `pendingPrint.current` guard already prevents spurious prints

**INT-02 — New Game from non-Game-Day tab doesn't navigate:**
When the user clicks "New Game" from the History or Settings tab, the dialog opens and reset happens, but the user stays on the current tab.

Fix: In both `handleDontSave` and `handleSaveAndNew`, add `setActiveTab('game-day')` before `setShowNewGameDialog(false)`.

Do NOT change `handleNewGameClick` or `handleCancelNewGame` — the dialog should open on any tab, and canceling should keep the user where they are.
  </action>
  <verify>
Run `npx tsc --noEmit` from repo root to confirm no type errors. Run `npm run build` to confirm production build succeeds.
  </verify>
  <done>
1. Re-printing with the same game label in the same session increments printSeq, causing the useEffect to fire and open the print dialog.
2. Completing New Game (Don't Save or Save & New) from any tab navigates to the Game Day tab.
  </done>
</task>

<task type="auto">
  <name>Task 2: Check off all v4.0 requirement checkboxes in REQUIREMENTS.md</name>
  <files>.planning/REQUIREMENTS.md</files>
  <action>
In `.planning/REQUIREMENTS.md`, change all 10 v4.0 requirement checkboxes from `- [ ]` to `- [x]`:

Under "### Desktop Layout":
- DESK-01, DESK-02, DESK-03, DESK-04 (completed in Phase 14)

Under "### Game Flow":
- GFLW-01 (completed in Phase 15, polished in Phase 18)
- GFLW-02 (completed in Phase 15)
- GFLW-03 (completed in Phase 17, polished in Phase 18)
- GFLW-04 (completed in Phase 17)

Under "### History Management":
- HMGT-01, HMGT-02 (completed in Phase 16)

Also update the Traceability table: change every Status from `Pending` to `Complete`.

Add a note at the bottom: `*All v4.0 requirements verified: 2026-02-17*`
  </action>
  <verify>
Count checkboxes: `grep -c '\[x\]' .planning/REQUIREMENTS.md` should return 10. `grep -c '\[ \]' .planning/REQUIREMENTS.md` should return 0 (for v4.0 section — deferred/future requirements don't count).
  </verify>
  <done>
All 10 v4.0 requirement checkboxes are checked. Traceability table shows Complete for all 10 requirements.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — no type errors
2. `npm run build` — production build succeeds
3. Manual: open app, generate lineup, print with label "Test Game", then print again with same label "Test Game" — both times the browser print dialog should open
4. Manual: navigate to History tab, click New Game in header, confirm Don't Save — user should land on Game Day tab
5. All 10 v4.0 checkboxes in REQUIREMENTS.md are checked
</verification>

<success_criteria>
- Re-printing with the same game label opens the print dialog (INT-01 fixed)
- New Game from any tab navigates to Game Day tab (INT-02 fixed)
- All 10 v4.0 requirements marked complete in REQUIREMENTS.md
- Build and type-check pass
</success_criteria>

<output>
After completion, create `.planning/phases/18-v4-polish-and-closeout/18-01-SUMMARY.md`
</output>
