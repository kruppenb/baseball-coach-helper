---
phase: 16-game-history-management
plan: 02
type: execute
wave: 2
depends_on: ["16-01"]
files_modified:
  - src/components/history/HistoryPage.tsx
  - src/components/history/HistoryPage.module.css
  - src/components/app-shell/AppShell.tsx
  - src/components/app-shell/AppShell.module.css
autonomous: true
requirements: [HMGT-01, HMGT-02]

must_haves:
  truths:
    - "Coach sees a list of saved games sorted newest first with date, game label, player count, and innings for each"
    - "Coach can tap/click a game entry to expand it inline showing positions and batting order detail"
    - "Coach can swipe left on a game entry on mobile to delete it"
    - "Coach sees a visible delete button on each game entry on desktop"
    - "Deleting a game shows a 5-second undo toast with no confirmation dialog"
    - "Tapping Undo in the toast restores the deleted game entry"
    - "Empty state shown when no games are saved"
    - "On desktop, history uses a single centered list (not two-column)"
  artifacts:
    - path: "src/components/history/HistoryPage.tsx"
      provides: "Full history list with expand/collapse, swipe-to-delete, undo toast"
      min_lines: 100
    - path: "src/components/history/HistoryPage.module.css"
      provides: "Styles for history list, cards, swipe gesture, desktop delete button, undo toast"
      min_lines: 80
  key_links:
    - from: "src/components/history/HistoryPage.tsx"
      to: "src/hooks/useGameHistory.ts"
      via: "useGameHistory().deleteGame and undoDelete"
      pattern: "deleteGame|undoDelete"
    - from: "src/components/history/HistoryPage.tsx"
      to: "src/hooks/useMediaQuery.ts"
      via: "useMediaQuery for desktop detection"
      pattern: "useMediaQuery"
---

<objective>
Redesign the HistoryPage with summary cards, inline expand/collapse detail,
swipe-to-delete on mobile, visible delete button on desktop, and a 5-second undo toast.

Purpose: Give the coach a complete interface to review and clean up game history.

Output: Fully functional history management UI matching all user decisions from the
phase context.
</objective>

<execution_context>
@C:/Users/nicho/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/nicho/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-game-history-management/16-CONTEXT.md
@.planning/phases/16-game-history-management/16-01-SUMMARY.md

@src/components/history/HistoryPage.tsx
@src/components/history/HistoryPage.module.css
@src/hooks/useGameHistory.ts
@src/hooks/useMediaQuery.ts
@src/types/index.ts
@src/styles/tokens.css
@src/components/game-day/Toast.tsx
@src/components/game-day/Toast.module.css
@src/components/app-shell/AppShell.tsx
@src/components/app-shell/AppShell.module.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Redesign HistoryPage with summary cards and inline expand/collapse</name>
  <files>
    src/components/history/HistoryPage.tsx
    src/components/history/HistoryPage.module.css
  </files>
  <action>
**Rewrite HistoryPage.tsx** to implement the new design per user decisions:

**Summary cards (HMGT-01):**
- Each card shows:
  - **Date** as primary/prominent text (formatted nicely, e.g. "Feb 16, 2026") — use `toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })`
  - **Game label** as secondary text underneath (e.g., "vs Tigers") — show only if `gameLabel` exists
  - **Player count and innings** as a summary line (e.g., "12 players, 6 innings")
- List sorted newest first (reverse the history array) — flat list, no date grouping headers
- Use card styling consistent with the rest of the app (--shadow-card, --radius-md, --color-surface background)

**Expand/collapse detail:**
- Each card is tappable to expand inline (use React state: `expandedId` string or null)
- When expanded, show:
  - **Batting order** as a numbered list of player names (from playerSummaries sorted by battingPosition)
  - **Fielding positions per player** in a compact table or list: player name, positions played (comma-separated), bench innings
- Collapse when tapped again or when another card is tapped (accordion behavior — only one expanded at a time)
- Use a subtle chevron icon (CSS-only triangle or `>` character) that rotates when expanded

**Empty state:**
- When no games saved, show a centered message: "No games recorded yet. Print a dugout card to save your first game."
- Style with muted text color, generous padding

**Desktop layout (per user decision):**
- Single centered list, not two-column
- Max-width ~700px centered on desktop to keep cards readable

**Rewrite HistoryPage.module.css** with styles for:
- `.page` — flex column, centered on desktop with max-width 700px
- `.title` — display font, large size
- `.gameList` — flex column with gap
- `.gameCard` — surface background, card shadow, border radius, padding, cursor pointer
- `.gameCard:hover` — subtle lift on desktop (--shadow-elevated)
- `.cardHeader` — flex layout for date + summary
- `.date` — prominent, bold, larger font
- `.label` — secondary text, muted color, smaller
- `.summary` — muted, small font (player count + innings)
- `.chevron` — rotation animation for expand indicator
- `.detail` — expanded content area with top border separator
- `.emptyState` — centered, muted, padded
  </action>
  <verify>
- `npm run build` at root passes
- Run `npm run dev`, navigate to History tab
- Cards display date prominently, game label secondary, player count and innings
- Tapping a card expands to show batting order and fielding details
- Tapping again or tapping another card collapses it
- Empty state shows when no games exist
  </verify>
  <done>
History tab shows a list of game summary cards sorted newest first. Each card shows date (prominent), game label (secondary, if present), player count, and innings. Tapping a card expands it inline to show batting order and fielding positions. Only one card expanded at a time. Empty state displayed when no games exist. Desktop shows a centered single-column list.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add swipe-to-delete, desktop delete button, and undo toast</name>
  <files>
    src/components/history/HistoryPage.tsx
    src/components/history/HistoryPage.module.css
    src/components/app-shell/AppShell.tsx
    src/components/app-shell/AppShell.module.css
  </files>
  <action>
**Swipe-to-delete on mobile (HistoryPage.tsx):**

Implement touch-based swipe-to-delete using pointer events (no library needed):
1. Track `onPointerDown` (record startX), `onPointerMove` (compute deltaX, apply translateX if swiping left), `onPointerUp` (if deltaX > threshold ~80px, trigger delete; otherwise animate back)
2. Use a ref or state per card for the current swipe offset
3. Show a red delete indicator behind the card as it swipes (absolute positioned `.deleteBackground` with red background and trash/X text)
4. Only enable swipe behavior on non-desktop (use `useMediaQuery('(min-width: 900px)')` to detect)
5. Set `touch-action: pan-y` on cards to prevent vertical scroll interference

**Visible delete button on desktop (HistoryPage.tsx):**

On desktop (isDesktop=true), render a delete button (small, right-aligned within the card header area):
- Text: "Delete" or an X icon
- Styled with --color-danger on hover
- Clicking triggers the same delete flow as swipe

**Delete + undo flow:**

1. When delete is triggered (swipe or button click):
   - Call `deleteGame(entryId)` from useGameHistory — this returns the removed entry
   - Record the removed entry and its original index in component state (`pendingUndo: { entry, index, timerId } | null`)
   - Show an undo toast for 5 seconds: "Game deleted" with an "Undo" button
   - Start a 5-second timer. When it expires, clear `pendingUndo` (deletion is permanent)
   - **No confirmation dialog** per user decision — immediate delete

2. If user taps "Undo" within 5 seconds:
   - Call `undoDelete(entry, originalIndex)` from useGameHistory
   - Clear the timer
   - Clear `pendingUndo`
   - Hide the toast

3. If another delete happens while undo is pending:
   - The previous delete becomes permanent (clear old timer)
   - New delete starts fresh undo window

**Undo toast UI:**

Build the undo toast directly in HistoryPage (don't reuse the existing Toast component since it lacks an action button):
- Fixed position at bottom center (above tab bar on mobile: bottom ~70px; on desktop: bottom ~24px)
- Dark background (--color-text), light text (--color-surface)
- Shows message "Game deleted" and an "Undo" button styled as a text link in --color-accent or white
- Auto-dismisses after 5 seconds
- Fade-in/out animation matching existing Toast pattern

**AppShell adjustments:**

In `AppShell.module.css`, ensure the `.contentDesktop` styles don't force a two-column layout when showing history. The existing styles should be fine since history is a flat panel, but verify.

In `AppShell.tsx`, the history panel's max-width should be handled by HistoryPage itself (via its own .page CSS), NOT by AppShell. The shell should just render the panel without additional layout constraints.

**HistoryPage.module.css additions:**
- `.deleteBackground` — absolute positioned red background behind swipeable card
- `.swipeWrapper` — relative container for card + delete background
- `.deleteBtn` — desktop delete button, subtle until hover
- `.undoToast` — fixed bottom toast with undo action
- `.undoToast .undoBtn` — styled text button for undo action
- Swipe animation: `transition: transform 0.2s ease` for snap-back
  </action>
  <verify>
- `npm run build` at root passes
- On mobile viewport (< 900px): swipe left on a card reveals red delete zone; completing swipe deletes the card and shows undo toast
- On desktop viewport (>= 900px): each card shows a delete button; clicking it deletes and shows undo toast
- Undo toast shows "Game deleted" with "Undo" button for 5 seconds
- Clicking Undo restores the deleted game entry to its original position
- Toast auto-dismisses after 5 seconds if Undo is not clicked
- No confirmation dialog appears before deletion
  </verify>
  <done>
Swipe-to-delete works on mobile (left swipe with red background indicator). Desktop shows a visible delete button per card. Deletion is immediate with no confirmation dialog. 5-second undo toast appears with "Undo" action button. Clicking Undo restores the entry. Toast auto-dismisses after 5 seconds. Deletion removes entry from both local storage and cloud sync.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` — no TypeScript or build errors
2. History tab shows game list sorted newest first
3. Each card: date prominent, game label secondary, player count + innings
4. Tap to expand: batting order + fielding positions shown inline
5. Mobile: swipe-to-delete with red background indicator
6. Desktop: visible delete button on each card
7. Delete triggers immediately (no confirmation dialog)
8. 5-second undo toast with Undo action button
9. Undo restores the deleted entry
10. Empty state displays when no games saved
11. Desktop: single centered list (not two-column)
</verification>

<success_criteria>
- Full history management UI matching all locked user decisions
- Summary cards with date, game label, player count, innings
- Expand/collapse inline detail (batting order, fielding positions)
- Swipe-to-delete on mobile, delete button on desktop
- 5-second undo toast with working Undo action
- No confirmation dialog
- Single centered list on desktop
- Clean TypeScript compilation
</success_criteria>

<output>
After completion, create `.planning/phases/16-game-history-management/16-02-SUMMARY.md`
</output>
